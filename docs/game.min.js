kontra={init(t){var n=this.canvas=document.getElementById(t)||t||document.querySelector("canvas");this.context=n.getContext("2d")},_noop:new Function,_tick:new Function},kontra.gameLoop=function(e){let t,n,a,r,o=(e=e||{}).fps||60,i=0,p=1e3/o,c=1/o,s=!1===e.clearCanvas?kontra._noop:function(){kontra.context.clearRect(0,0,kontra.canvas.width,kontra.canvas.height)};function d(){if(n=requestAnimationFrame(d),a=performance.now(),r=a-t,t=a,!(r>1e3)){for(kontra._tick(),i+=r;i>=p;)m.update(c),i-=p;s(),m.render()}}let m={update:e.update,render:e.render,isStopped:!0,start(){t=performance.now(),this.isStopped=!1,requestAnimationFrame(d)},stop(){this.isStopped=!0,cancelAnimationFrame(n)}};return m},function(){class t{constructor(t,i){this._x=t||0,this._y=i||0}add(t,i){this.x+=(t.x||0)*(i||1),this.y+=(t.y||0)*(i||1)}clamp(t,i,h,s){this._c=!0,this._a=t,this._b=i,this._d=h,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}kontra.vector=((i,h)=>new t(i,h)),kontra.vector.prototype=t.prototype;class i{init(t,i,h,s){for(i in t=t||{},this.position=kontra.vector(t.x,t.y),this.velocity=kontra.vector(t.dx,t.dy),this.acceleration=kontra.vector(t.ddx,t.ddy),this.width=this.height=0,this.context=kontra.context,t)this[i]=t[i];if(h=t.image)this.image=h,this.width=h.width,this.height=h.height;else if(h=t.animations){for(i in h)this.animations[i]=h[i].clone(),s=s||h[i];this._ca=s,this.width=s.width,this.height=s.height}return this}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}collidesWith(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this._ca=this.animations[t],this._ca.loop||this._ca.reset()}advance(t){this.velocity.add(this.acceleration,t),this.position.add(this.velocity,t),this.ttl--,this._ca&&this._ca.update(t)}draw(){this.image?this.context.drawImage(this.image,this.x,this.y):this._ca?this._ca.render(this):(this.context.fillStyle=this.color,this.context.fillRect(this.x,this.y,this.width,this.height))}}kontra.sprite=(t=>(new i).init(t)),kontra.sprite.prototype=i.prototype}(),function(){class t{constructor(t,i){t=t||{},this.spriteSheet=t.spriteSheet,this.frames=t.frames,this.frameRate=t.frameRate,this.loop=void 0===t.loop||t.loop,i=t.spriteSheet.frame,this.width=i.width,this.height=i.height,this.margin=i.margin||0,this._f=0,this._a=0}clone(){return kontra.animation(this)}reset(){this._f=0,this._a=0}update(t){if(this.loop||this._f!=this.frames.length-1)for(t=t||1/60,this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render(t){t=t||{};let i=this.frames[this._f]/this.spriteSheet._f|0,e=this.frames[this._f]%this.spriteSheet._f|0;(t.context||kontra.context).drawImage(this.spriteSheet.image,e*this.width+(2*e+1)*this.margin,i*this.height+(2*i+1)*this.margin,this.width,this.height,t.x,t.y,this.width,this.height)}}kontra.animation=function(i){return new t(i)},kontra.animation.prototype=t.prototype;class i{constructor(t){t=t||{},this.animations={},this.image=t.image,this.frame={width:t.frameWidth,height:t.frameHeight,margin:t.frameMargin},this._f=t.image.width/t.frameWidth|0,this.createAnimations(t.animations)}createAnimations(t){let i,e,h,s;for(s in t)e=(i=t[s]).frames,h=[],[].concat(e).map(function(t){h=h.concat(this._p(t))},this),this.animations[s]=kontra.animation({spriteSheet:this,frames:h,frameRate:i.frameRate,loop:i.loop})}_p(t,i){if(+t===t)return t;let e=[],h=t.split(".."),s=i=+h[0],a=+h[1];if(s<a)for(;i<=a;i++)e.push(i);else for(;i>=a;i--)e.push(i);return e}}kontra.spriteSheet=function(t){return new i(t)},kontra.spriteSheet.prototype=i.prototype}();
window.addEventListener("keyup",function(event){Key.onKeyup(event)},!1),window.addEventListener("keydown",function(event){Key.onKeydown(event)},!1),Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,W:87,A:65,S:83,D:68,isDown(keyCode){return this._pressed[keyCode]},released(keyCode){return this._released[keyCode]},onKeydown(event){this._pressed[event.keyCode]=!0},onKeyup(event){this._released[event.keyCode]=!0,delete this._pressed[event.keyCode]},update(){this._released={}}};
var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");const CANVAS_W=canvas.width,CANVAS_H=canvas.height,OBJ_SIZE=32,GAME_X=50,GAME_Y=0,GAME_W=700,GAME_H=400,BOUND_X=718,BOUND_Y=368;var S={},G={};kontra.init();
function collision(){let collision_pair=active_collision();for(let i=0;i<collision_pair.length;i++){let f1=G.asteroids[collision_pair[i][0]],f2=G.asteroids[collision_pair[i][1]];if(("player"==f1.type||"player"==f2.type)&&void 0!=resolveCollision(f1,f2))return void(S.playing.resetLevel=!0);resolveCollision(f1,f2)}}function resolveCollision(f1,f2){let rV=kontra.vector(f2.dx-f1.dx,f2.dy-f1.dy),impulse=getNormalVector(f1,f2);if(0==impulse.x&&0==impulse.y)return;if(f1.dx>0&&!(f2.dx>0)&&-1==impulse.x)return;if(f1.dy>0&&!(f2.dy>0)&&-1==impulse.y)return;let j=-1.98*(rV.x*impulse.x+rV.y*impulse.y)*5;return f1.dx-=.1*impulse.x*j,f1.dy-=.1*impulse.y*j,f2.dx+=.1*impulse.x*j,f2.dy+=.1*impulse.y*j,impulse}function active_collision(){let frags=[],active=[],collision_check=[];for(let i=0;i<G.asteroids.length;i++){let b=G.asteroids[i].x,e=b+OBJ_SIZE;frags.push({item:i,b,e})}frags.sort(function(f1,f2){return f1.b-f2.b});for(let i=0;i<frags.length;i++){for(let j=0;j<active.length;j++)if(active[j].e+3<frags[i].b){for(let k=j;k<active.length-1;k++)active[k]=active[k+1];j--,active.pop()}else collision_check.push([frags[i].item,active[j].item]);active.push(frags[i])}return collision_check}function getNormalVector(f1,f2){let n=kontra.vector(f1.x+f1.width/2-f2.x-f2.width/2,f1.y+f1.height/2-f2.y-f2.height/2),v=kontra.vector(f2.x-f1.x,f2.y-f1.y),normalVector=kontra.vector(0,0),overlapX=f1.width/2+f2.width/2-Math.abs(n.x),overlapY=f1.height/2+f2.height/2-Math.abs(n.y);return overlapX>=0&&overlapY>=0&&(overlapX>overlapY?v.y<0?(normalVector.x=0,normalVector.y=-1):(normalVector.x=0,normalVector.y=1):v.x<0?(normalVector.x=-1,normalVector.y=0):(normalVector.x=1,normalVector.y=0)),normalVector}
let asteroid=new Image;function spawnAsteroid(values){return kontra.sprite({type:"asteroid",x:GAME_X+values[0],y:GAME_Y+values[1],color:"#808000",height:OBJ_SIZE,width:OBJ_SIZE,image:asteroid,dx:values[2],dy:values[3],maxSpeed:10,update:function(){this.x<GAME_X&&(this.dx=Math.abs(this.dx)),this.x>BOUND_X&&(this.dx=-Math.abs(this.dx)),this.y>BOUND_Y&&(this.dy=-Math.abs(this.dy)),this.y<GAME_Y&&(this.dy=Math.abs(this.dy)),this.dx>this.maxSpeed?this.dx=this.maxSpeed:this.dx<-this.maxSpeed&&(this.dx=-this.maxSpeed),this.dy>this.maxSpeed?this.dy=this.maxSpeed:this.dy<-this.maxSpeed&&(this.dy=-this.maxSpeed),this.advance(),this.grabbed&&(player.x=this.x,player.y=this.y)}})}function spawnRandomAsteroids(n){for(let i=0;i<n;i++)G.asteroids.push(spawnAsteroid([Math.floor(Math.random()*BOUND_X+1),Math.floor(Math.random()*BOUND_Y+1),3*Math.random()-1.5,3*Math.random()-1.5]))}asteroid.src="./art/meteor2.png";
var player;let alien=new Image;alien.src="./art/alien.png",alien.onload=function(){player=kontra.sprite({type:"player",x:100,y:0,width:40,height:40,dx:0,dy:0,image:alien,color:"red",maxSpeed:5,colliding:[0,0,0,0],barrier:[1,0,0,0],handleInput:function(){this.barrier=[0,0,0,0],Key.isDown(Key.UP)?(this.ddy=-.1,this.dy>0&&(this.ddy=-.15)):Key.isDown(Key.DOWN)?(this.ddy=.1,this.dy<0&&(this.ddy=.15)):this.ddy=0,Key.isDown(Key.LEFT)?(this.ddx=-.1,this.dx>0&&(this.ddx=-.15)):Key.isDown(Key.RIGHT)?(this.ddx=.1,this.dx<0&&(this.ddx=.15)):this.ddx=0},update:function(){this.x<GAME_X&&(this.dx=.95*Math.abs(this.dx)),this.x>BOUND_X&&(this.dx=.95*-Math.abs(this.dx)),this.y>BOUND_Y&&(this.dy=.95*-Math.abs(this.dy)),this.y<GAME_Y&&(this.dy=.95*Math.abs(this.dy)),this.dx>this.maxSpeed&&(this.dx=this.maxSpeed),this.dx<-this.maxSpeed&&(this.dx=-this.maxSpeed),this.dy>this.maxSpeed&&(this.dy=this.maxSpeed),this.dy<-this.maxSpeed&&(this.dy=-this.maxSpeed),this.advance()}})};
S.menu={update:function(){0==G.asteroids.length&&spawnRandomAsteroids(7),collision();for(let i=0;i<G.asteroids.length;i++)G.asteroids[i].update();Key.released(Key.SPACE)&&(G.state="playing",S.playing.level++,S.playing.resetLevel=!0)},render:function(){for(let i=0;i<G.asteroids.length;i++)G.asteroids[i].render();ctx.save(),ctx.globalAlpha=.4,ctx.fillStyle="blue",ctx.fillRect(0,0,CANVAS_W,CANVAS_H),ctx.closePath(),ctx.restore(),ctx.save(),ctx.globalAlpha=.9,ctx.fillStyle="#020811",ctx.fillRect(CANVAS_W/4,CANVAS_H/4,CANVAS_W/2,CANVAS_H/2),ctx.fillStyle="white",ctx.font="small-caps 30px verdana",ctx.fillText("FRIENDLY ALIEN",CANVAS_W/4+75,CANVAS_H/2-50,300),ctx.font="small-caps 15px verdana",ctx.fillText("PRESS SPACE TO PLAY",CANVAS_W/4+120,CANVAS_H/2,300),ctx.font="small-caps 15px verdana",ctx.fillText("arrow to move",CANVAS_W/3+80,CANVAS_H/2+50,200),ctx.restore()}};
S.playing={level:-1,gameOver:0,resetLevel:!0,t:0,update:function(dt){if(this.resetLevel){if(void 0==G.levels[this.level])return void(G.state="gameover");this.loadLevel(G.levels[this.level]),this.resetLevel=!1,this.t=0,station.state="broken"}player.handleInput(),this.t+=dt,station.winLogic(),collision();for(let i=1;i<G.asteroids.length;i++)G.asteroids[i].update();this.gameOver?(player.dx=player.dy=0,G.asteroids=[]):player.update(),station.update()},loadLevel:function(level){G.asteroids=[],G.asteroids.push(player);for(let i=0;i<level.f.length;i++)G.asteroids.push(spawnAsteroid(level.f[i]));player.x=level.p[0],player.y=level.p[1],player.dx=level.p[2],player.dy=level.p[3]},render:function(){if("playing"==G.state){this.t<1&&(ctx.save(),ctx.globalAlpha=.9,ctx.fillStyle="#020811",ctx.fillRect(325,175,160,50),ctx.fillStyle="white",ctx.font="small-caps 30px verdana",ctx.fillText("LEVEL "+(this.level+1),350,210,200),ctx.restore()),grid.render();for(let i=0;i<G.asteroids.length;i++)G.asteroids[i].render();player.render(),station.render()}}};
S.level_won={t:0,update:function(dt){player.dx=0,player.dy=0,this.t+=dt,station.state="fixing",station.update(),this.t>2&&(G.state="playing",S.playing.resetLevel=!0,S.playing.level++)},render:function(){grid.render(),player.render(),station.render()}};
var station,satelite=new Image;satelite.src="./art/satelite.png",satelite.onload=function(){var stationSprite=kontra.spriteSheet({image:satelite,frameWidth:50,frameHeight:245,animations:{broken:{frames:[0],frameRate:1},fixing:{frames:[0,1,0,0,1,0,1,1,1,1,1,1],frameRate:6}}});station=kontra.sprite({x:750,y:100,width:50,height:245,state:"broken",animations:stationSprite.animations,winLogic:function(){if(player.x+player.width+5>this.x&&this.y+72.5<player.y&&player.y<this.y+172.5)return G.state="level_won",S.level_won.t=0,!0},update:function(){this.playAnimation(this.state),this.advance()}})};
S.gameover={update:function(){0==G.asteroids.length&&spawnRandomasteroids(7),collision();for(let i=0;i<G.asteroids.length;i++)G.asteroids[i].update();Key.released(Key.SPACE)&&(G.state="menu",S.playing.level=-1)},render:function(){ctx.save(),ctx.globalAlpha=.9,ctx.fillStyle="#020811",ctx.fillRect(CANVAS_W/4,CANVAS_H/4,CANVAS_W/2,CANVAS_H/2),ctx.restore(),ctx.save(),ctx.fillStyle="white",ctx.font="small-caps 30px verdana",ctx.fillText("THE END",CANVAS_W/4+50,CANVAS_H/2,300),ctx.font="small-caps 15px verdana",ctx.fillText("THANKS FOR PLAYING",CANVAS_W/3+80,CANVAS_H/2+50,200),ctx.restore()}};
var grid={render:function(){ctx.save(),ctx.beginPath(),ctx.rect(GAME_X,GAME_Y,GAME_W,GAME_H),ctx.strokeStyle="rgba(0, 0, 255, 0.5)",ctx.stroke(),ctx.closePath(),ctx.restore()}};
var level_1={f:[[300,50,0,2],[400,50,0,2],[500,50,0,2],[600,50,0,2],[300,350,0,-2],[400,350,0,-2],[500,350,0,-2],[600,350,0,-2]],p:[200,200,0,2]},level_2={f:[[650,50,0,2],[650,200,0,-2],[600,75,0,2],[600,225,0,-2],[550,100,0,2],[550,250,0,-2],[500,125,0,2],[500,275,0,-2],[450,150,0,2],[450,300,0,-2]],p:[100,0,0,0]},level_3={f:[[50,25,0,0],[150,25,0,0],[250,25,0,0],[350,25,0,0],[450,25,0,0],[50,125,0,0],[150,125,0,0],[250,125,0,0],[350,125,0,0],[540,100,0,0],[660,125,0,0],[450,200,0,0],[550,255,0,0],[650,255,0,0],[0,75,2,0]],p:[150,75,0,0]},level_4={f:[[400,50,-8,3],[400,318,-8,-3],[500,115,-10,1],[500,253,-10,-1],[600,180,-9,0]],p:[50,180,0,0]},level_5={f:[[650,50,0,2],[650,200,0,-2],[600,75,0,2],[600,225,0,-2],[550,100,0,2],[550,250,0,-2],[500,125,0,2],[500,275,0,-2],[450,150,0,2],[450,300,0,-2],[400,175,0,2],[400,325,0,-2],[350,200,0,2],[350,350,0,-2],[300,225,0,2],[300,375,0,-2]],p:[100,100,0,2]},level_6={f:[[650,50,4,0],[600,103.6,4,0],[550,157.2,4,0],[550,210.8,4,0],[600,264.4,4,0],[650,318,4,0]],p:[50,180,0,2]},level_7={f:[[300,-600,0,6],[350,-600,0,6],[400,-600,0,6],[450,-600,0,6],[500,-600,0,6],[550,-600,0,6],[600,-600,0,6]],p:[100,100,0,0]},level_8={f:[[650,25,0,4],[650,343,0,-4],[600,50,0,3.7],[600,318,0,-3.7],[550,75,0,3.4],[550,293,0,-3.4],[500,100,0,3.1],[500,268,0,-3.1],[450,125,0,2.8],[450,243,0,-2.8],[400,150,0,2.5],[400,218,0,-2.5]],p:[50,180,0,0]};
var background={stars:[],randomizeStar:function(){for(let i=0;i<100;i++)this.stars.push([800*Math.random(),400*Math.random(),5*Math.random()])},render:function(){ctx.save(),ctx.beginPath(),ctx.rect(0,0,CANVAS_W,CANVAS_H),ctx.fillStyle="rgba(8, 6, 51, 1)",ctx.fill(),ctx.closePath();for(let i=0;i<100;i++)ctx.beginPath(),ctx.fillStyle="rgba(255, 255, 255, 0.8)",ctx.arc(this.stars[i][0],this.stars[i][1],this.stars[i][2],0,2*Math.PI),ctx.fill();ctx.restore()}};
function init(){G.state="menu",G.levels=[level_1,level_2,level_3,level_4,level_5,level_6,level_7,level_8],G.asteroids=[],background.randomizeStar()}let loop_k=kontra.gameLoop({fps:60,clearCanvas:!1,update:function(dt){"playing"==G.state?S.playing.update(dt):"menu"==G.state?S.menu.update():"level_won"==G.state?S.level_won.update(dt):"gameover"==G.state&&S.gameover.update(),Key.update()},render:function(){background.render(),"playing"==G.state?S.playing.render():"menu"==G.state?S.menu.render():"level_won"==G.state?S.level_won.render():"gameover"==G.state&&S.gameover.render()}});init(),loop_k.start();